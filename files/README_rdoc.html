<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>README.rdoc</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>README.rdoc
</h1>
<div class='paths'>
README.rdoc
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2022-06-28 09:27:52 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-AutoForme"><a href="../classes/AutoForme.html"><code>AutoForme</code></a><span><a href="#label-AutoForme">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="../classes/AutoForme.html"><code>AutoForme</code></a> is an administrative web front end to an ORM that uses Forme [1] for building the HTML forms.  It is designed to integrate easily into web frameworks, and currently supports <a href="../classes/Roda.html"><code>Roda</code></a>, Sinatra, and Rails.  The only currently supported ORM is Sequel::Model.</p>
<ol><li>
<p><a target="_top" href="https://github.com/jeremyevans/forme">github.com/jeremyevans/forme</a></p>
</li></ol>

<h1 id="label-Installation">Installation<span><a href="#label-Installation">&para;</a> <a href="#top">&uarr;</a></span></h1>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">autoforme</span>
</pre>

<h1 id="label-Links">Links<span><a href="#label-Links">&para;</a> <a href="#top">&uarr;</a></span></h1>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>Demo Site </td><td>
<p><a target="_top" href="http://autoforme-demo.jeremyevans.net">autoforme-demo.jeremyevans.net</a></p>
</td></tr><tr><td class='label'>RDoc </td><td>
<p><a target="_top" href="http://autoforme.jeremyevans.net">autoforme.jeremyevans.net</a></p>
</td></tr><tr><td class='label'>Source </td><td>
<p><a target="_top" href="https://github.com/jeremyevans/autoforme">github.com/jeremyevans/autoforme</a></p>
</td></tr><tr><td class='label'>Discussion Forum </td><td>
<p><a target="_top" href="https://github.com/jeremyevans/autoforme/discussions">github.com/jeremyevans/autoforme/discussions</a></p>
</td></tr><tr><td class='label'>Bug Tracker </td><td>
<p><a target="_top" href="https://github.com/jeremyevans/autoforme/issues">github.com/jeremyevans/autoforme/issues</a></p>
</td></tr></tbody></table>

<h1 id="label-Features">Features<span><a href="#label-Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Create, update, edit, and view model objects</p>
</li><li>
<p>Browse and search model objects</p>
</li><li>
<p>Edit many-to-many relationships for model objects</p>
</li><li>
<p>Easily access associated objects</p>
</li><li>
<p>Support autocompletion for all objects</p>
</li><li>
<p>Allow customization for all likely configuration points, using any parameters available in the request</p>
</li></ul>

<h1 id="label-Basic+Configuration">Basic Configuration<span><a href="#label-Basic+Configuration">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="../classes/AutoForme.html"><code>AutoForme</code></a> is configured using a fairly simple DSL.  Here is an example for Sinatra:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-constant">AutoForme</span>.<span class="ruby-identifier">for</span>(<span class="ruby-value">:sinatra</span>, <span class="ruby-keyword">self</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">order</span> [<span class="ruby-value">:name</span>]

    <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">columns</span> [<span class="ruby-value">:name</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Album</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">columns</span> [<span class="ruby-value">:artist</span>, <span class="ruby-value">:name</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Let’s break down how this works.  You setup <a href="../classes/AutoForme.html"><code>AutoForme</code></a> using <code>AutoForme.for</code>, which takes 2 arguments, the controller type symbol (currently either :sinatra, :roda, or :rails), and the controller class (either a Sinatra::Base, <a href="../classes/Roda.html"><code>Roda</code></a>, or ActionController::Base subclass).  You pass <code>AutoForme.for</code> a block, which is instance evaled at the framework level.  This level sets the defaults.</p>

<p>The order call in the framework block sets the default order for all models.</p>

<p>The model calls in the framework block take a ORM model class.  As only Sequel is currently supported, this should be a Sequel::Model subclass.  The block passed to the model method is instance evaled at the model level, and sets the configuration for that model.  In this example, the Artist model will only show the name column, and the Album model will only show the artist association and the name column.</p>

<p>In your application, you can then to go ‘/Artist/browse’ or ‘/Album/browse’ to get to the web UI exposed to <a href="../classes/AutoForme.html"><code>AutoForme</code></a>.</p>

<h1 id="label-Design">Design<span><a href="#label-Design">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-Principles">Principles<span><a href="#label-Principles">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>Use Forme to generate the forms</p>
</li><li>
<p>Do not modify/extend model or controller classes</p>
</li><li>
<p>Assume that the web framework provides the layout</p>
</li><li>
<p>Do not use templates, render form objects to strings</p>
</li><li>
<p>Use a block-based DSL in the controller for configuration</p>
</li><li>
<p>Allow customization on a per-request basis for everything</p>
</li></ul>

<h2 id="label-Basic+Implementation">Basic Implementation<span><a href="#label-Basic+Implementation">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The web framework controllers call <code>AutoForme.for</code> to create <a href="../classes/AutoForme/Framework.html"><code>AutoForme::Framework</code></a> instances, which contain and set default values for <a href="../classes/AutoForme/Model.html"><code>AutoForme::Model</code></a> instances.</p>

<p>When a request comes in from the web framework, the <a href="../classes/AutoForme/Framework.html"><code>AutoForme::Framework</code></a> instance wraps request-level data in a <a href="../classes/AutoForme/Request.html"><code>AutoForme::Request</code></a>.  Then it creates an <a href="../classes/AutoForme/Action.html"><code>AutoForme::Action</code></a> to handle this request.  The <a href="../classes/AutoForme/Action.html"><code>AutoForme::Action</code></a> either returns a string that the web framework then renders, or it redirects to another page.</p>

<h1 id="label-Advanced+Configuration">Advanced Configuration<span><a href="#label-Advanced+Configuration">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="../classes/AutoForme.html"><code>AutoForme</code></a> doesn’t have all that many features compared to other admin frameworks, but the features it does have are extremely flexible.</p>

<p>Most of the configuration you’ll do in <a href="../classes/AutoForme.html"><code>AutoForme</code></a> is at the model level (in the context of an <a href="../classes/AutoForme/Model.html"><code>AutoForme::Model</code></a> instance), so we’ll start looking at the customization options there.  The most common options are probably:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>columns </td><td>
<p>This is an array of column/association name symbols to use for the model.</p>
</td></tr><tr><td class='label'>column_options </td><td>
<p>This is a hash of column options for the model, keyed by column symbol, with values that are hashes of column options.</p>
</td></tr><tr><td class='label'>order </td><td>
<p>This is an expression or an array of expressions by which to order returned rows.</p>
</td></tr></tbody></table>

<p>Note that for each of the customization options, you can do per-request customization by using a proc which is called with the type symbol and request (<a href="../classes/AutoForme/Request.html"><code>AutoForme::Request</code></a> instance), which should return an appropriate object.</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>columns </td><td>
<p>Proc called with type symbol and request, should return array of column/association symbols</p>
</td></tr><tr><td class='label'>column_options </td><td>
<p>Proc called with column/association symbol, type symbol and request, should return hash of column options.</p>
</td></tr><tr><td class='label'>order </td><td>
<p>Proc called with type symbol and request, should return expression  or array of expressions by which to order returned rows.</p>
</td></tr></tbody></table>

<p>Below is brief description of other available options.  Note that just like the above options you can use Procs with most of these options to do customization on a per-request basis.</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>association_links </td><td>
<p>Array of association symbols for associations to display on the show/edit pages, can also be set to :all for all associations or :all_except_mtm for all associations except many to many associations.</p>
</td></tr><tr><td class='label'>autocomplete_options </td><td>
<p>Enable autocompletion for this model, with the given options.  The following keys are respected:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:callback </td><td>
<p>Proc called with dataset and options hash containing :type, :request, and :query</p>
</td></tr><tr><td class='label'>:display </td><td>
<p>A SQL expression to search on and display in the result</p>
</td></tr><tr><td class='label'>:limit </td><td>
<p>The number of results to return</p>
</td></tr><tr><td class='label'>:filter </td><td>
<p>Similar to callback, but overriding the default filter (a case insensitive substring search on display)</p>
</td></tr></tbody></table>
</td></tr><tr><td class='label'>eager </td><td>
<p>Array of associations to eagerly load in separate queries</p>
</td></tr><tr><td class='label'>eager_graph </td><td>
<p>Array of associations to eager load in the same query (necessary if order or filter refers to them)</p>
</td></tr><tr><td class='label'>filter </td><td>
<p>A Proc called with a dataset, type symbol, and request that can be used to filter the available rows.  Can be used to implement access control.</p>
</td></tr><tr><td class='label'>redirect </td><td>
<p>A Proc called with an object, type symbol, and request that can be used to override the default redirecting after form submittal.</p>
</td></tr><tr><td class='label'>inline_mtm_associations </td><td>
<p>Array of many to many association symbols to allow editing on the edit page</p>
</td></tr><tr><td class='label'>lazy_load_association_links </td><td>
<p>Whether to show the association links directly on the show/edit pages, or to load them via ajax on request</p>
</td></tr><tr><td class='label'>mtm_associations </td><td>
<p>Array of many to many association symbols to support editing on a separate page </p>
</td></tr><tr><td class='label'>per_page </td><td>
<p>Number of records to show per page on the browse and search pages</p>
</td></tr><tr><td class='label'>session_value </td><td>
<p>Sets up a filter and before_create hook that makes it so access is limited to objects where the object’s column value is the same as the session value with the same name.</p>
</td></tr><tr><td class='label'>supported_actions </td><td>
<p>Array of action symbols to support for the model, should be a subset of</p>
<table class="rdoc-list label-list"><tbody><tr><td class='label'>:browse, :new, :show, :edit, :delete, :search, :mtm_edit</td><td></td></tr></tbody></table>
</td></tr></tbody></table>

<p>These options are related to displayed output:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>form_attributes </td><td>
<p>Hash of attributes to use for any form tags</p>
</td></tr><tr><td class='label'>form_options </td><td>
<p>Hash of Forme::Form options to pass for any forms created</p>
</td></tr><tr><td class='label'>class_display_name </td><td>
<p>The string to use on pages when referring to the model class. This defaults to the full class name.</p>
</td></tr><tr><td class='label'>display_name </td><td>
<p>The string to use when referring to a model instance.  Can either be a symbol representing an instance method call, or a Proc called with the model object, the model object and type symbol, or the model object, type symbol, and request, depending on the arity of the Proc.</p>
</td></tr><tr><td class='label'>link_name </td><td>
<p>The string to use in links for the class. This defaults to <code>class_display_name</code>.</p>
</td></tr><tr><td class='label'>edit_html </td><td>
<p>The html to use for a particular object edit field.  Should be a proc that takes the model object, column symbol, type symbol, and request and returns the html to use.</p>
</td></tr><tr><td class='label'>page_footer </td><td>
<p>Override the default footer used for pages</p>
</td></tr><tr><td class='label'>page_header </td><td>
<p>Override the default header used for pages</p>
</td></tr><tr><td class='label'>show_html </td><td>
<p>The html to use for displaying the value for an object field.  Should be a proc that takes the model object, column symbol, type symbol, and request and returns the html to use.</p>
</td></tr><tr><td class='label'>table_class </td><td>
<p>The html class string to use for the browse and search tables</p>
</td></tr><tr><td class='label'>view_options </td><td>
<p>Hash with options passed when rendering the view (how these options are used varies in each of the supported web frameworks), e.g. <code>view_options: {:layout =&gt; :formelayout}</code></p>
</td></tr></tbody></table>

<p>These hook options should be callable objects that are called with the model object and the request.</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>after_create </td><td>
<p>Called after creating the object</p>
</td></tr><tr><td class='label'>after_destroy </td><td>
<p>Called after destroying the object</p>
</td></tr><tr><td class='label'>after_update </td><td>
<p>Called after updating the object</p>
</td></tr><tr><td class='label'>before_create </td><td>
<p>Called before creating the object </p>
</td></tr><tr><td class='label'>before_destroy </td><td>
<p>Called before destroy the object</p>
</td></tr><tr><td class='label'>before_edit </td><td>
<p>Called before displaying object on edit page</p>
</td></tr><tr><td class='label'>before_new </td><td>
<p>Called before displaying object on new page</p>
</td></tr><tr><td class='label'>before_update </td><td>
<p>Called before updating the object</p>
</td></tr></tbody></table>

<p>There’s also an addition before_action hook that is called with the type symbol of the request, and the request before every page.</p>

<p>In addition to being specified at the model level, almost all of these options can be specified at the framework level, where they operate as default values for models that don’t specify the options. Just like the model level, the framework level also allows customization on a per request basis, though framework-level Procs generally take the model class as an initial argument (in addition to the type symbol and request).</p>

<p>Additionally, <a href="../classes/AutoForme.html#method-c-for"><code>AutoForme.for</code></a> accepts a :prefix option that controls where the forms are mounted:</p>

<pre class="ruby"><span class="ruby-constant">AutoForme</span>.<span class="ruby-identifier">for</span>(<span class="ruby-value">:sinatra</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">:prefix</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;/path/to&#39;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Means you can go to <code>/path/to/Artist/browse</code> to browse the artists.</p>

<h1 id="label-Javascript">Javascript<span><a href="#label-Javascript">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>By default, <a href="../classes/AutoForme.html"><code>AutoForme</code></a> requires no javascript.  The only optional part of <a href="../classes/AutoForme.html"><code>AutoForme</code></a> that requires javascript is the autocompleting. <a href="../classes/AutoForme.html"><code>AutoForme</code></a> also has javascript support for the progressive enhancement of the following:</p>
<ul><li>
<p>Loading association links via ajax if lazy_load_association_links is true.</p>
</li><li>
<p>Adding and removing many-to-many associated objects via ajax for inline_mtm_associations</p>
</li></ul>

<p>AutoForme’s javascript support is contained in the <code>autoforme.js</code> file in the root of the repository.  AutoForme’s autocompleting support also requires <a target="_top" href="https://github.com/Pixabay/JavaScript-autoComplete">github.com/Pixabay/JavaScript-autoComplete</a></p>

<p>Make sure to load the <code>autoforme.js</code> file after the DOM content has been loaded, such as at the end of the body.</p>

<h1 id="label-Reloading+Code">Reloading Code<span><a href="#label-Reloading+Code">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>By default, <a href="../classes/AutoForme.html"><code>AutoForme</code></a> stores classes by reference.  This can cause issues when using code reloading in development environments.  You can call <code>register_by_name</code> to set Autoforme to store classes by name, so that if a class is removed and reloaded (giving a new class reference), it will use the new class instead of the reference to the old class.  Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-constant">AutoForme</span>.<span class="ruby-identifier">for</span>(<span class="ruby-value">:sinatra</span>, <span class="ruby-keyword">self</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">register_by_name</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h1 id="label-Rails">Rails<span><a href="#label-Rails">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Because Rails separates routing from request handling, it can be little awkward to use <a href="../classes/AutoForme.html"><code>AutoForme</code></a> in Rails development mode.  The best way to handle it is to call <code>AutoForme.for</code> in the related controller file, and have an initializer reference the controller class, causing the controller file to be loaded.</p>

<h1 id="label-Roda"><a href="../classes/Roda.html"><code>Roda</code></a><span><a href="#label-Roda">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Because <a href="../classes/Roda.html"><code>Roda</code></a> uses a routing tree, unlike Rails and Sinatra, with <a href="../classes/Roda.html"><code>Roda</code></a> you need to dispatch to the autoforme routes at the point in the routing tree where you want to mount them.  Additionally, the <a href="../classes/Roda.html"><code>Roda</code></a> support offers a <a href="../classes/Roda.html"><code>Roda</code></a> plugin for easier configuration.</p>

<p>To mount the autoforme routes in the root of the application, you could do:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:autoforme</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># rest of routing tree</span>
    <span class="ruby-identifier">autoforme</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To mount the routes in a subpath:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:autoforme</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;admin&quot;</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">autoforme</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># rest of routing tree</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To handle multiple autoforme configurations, mounted at different subpaths:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:autoforme</span>

  <span class="ruby-identifier">autoforme</span>(<span class="ruby-value">name:</span> <span class="ruby-string">&#39;artists&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Artist</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">autoforme</span>(<span class="ruby-value">name:</span> <span class="ruby-string">&#39;albums&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">model</span> <span class="ruby-constant">Album</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;artists&quot;</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">autoforme</span>(<span class="ruby-string">&#39;artists&#39;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;albums&quot;</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">autoforme</span>(<span class="ruby-string">&#39;albums&#39;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># rest of routing tree</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h1 id="label-TODO">TODO<span><a href="#label-TODO">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>capybara-webkit tests for ajax behavior</p>
</li><li>
<p>read_only fields for edit page</p>
</li><li>
<p>one_to_many/many_to_many associations in columns</p>
</li><li>
<p>configurable searching</p>
</li><li>
<p>nested form objects</p>
</li></ul>

<h1 id="label-License">License<span><a href="#label-License">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>MIT</p>

<h1 id="label-Author">Author<span><a href="#label-Author">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Jeremy Evans &lt;code@jeremyevans.net&gt;</p>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
